{% load static %}
<!doctype html>
<html lang="es" data-theme="light">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>{% block title %}WebAMG{% endblock %}</title>
    <link rel="icon" type="image/svg+xml" href="{% static 'src/img/vectoresMG/favicon.svg' %}" crossorigin="anonymous" />
    <link rel="stylesheet" href="{% static 'dist/css/styles.css' %}" />
    <link rel="stylesheet" href="{% static 'src/css/project_detail.css' %}" />
    <link rel="stylesheet" href="{% static 'src/css/dashboard_utilities.css' %}" />
    <link rel="stylesheet" href="{% static 'src/css/font-awesome-fallback.css' %}" />
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Font Awesome CDN SIN integrity (para evitar errores de verificación) -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" crossorigin="anonymous" referrerpolicy="no-referrer" />
    
    <!-- Fallback de Font Awesome 6.4.0 -->
    <link id="font-awesome-fallback" rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" crossorigin="anonymous" referrerpolicy="no-referrer" disabled />
    
    {% block extra_css %}{% endblock %}
</head>
<body class="min-h-dvh bg-white text-gray-900">
    {% block dashboard_sidebar %}{% endblock %}
    {% block content %}{% endblock %}
    {% block extra_js %}{% endblock %}
    
    <script>
    // Script de detección y fallback para Font Awesome
    window.addEventListener('DOMContentLoaded', function() {
        const testIcon = document.createElement('i');
        testIcon.className = 'fas fa-user';
        testIcon.style.position = 'absolute';
        testIcon.style.left = '-9999px';
        document.body.appendChild(testIcon);
        
        setTimeout(function() {
            const computedStyle = window.getComputedStyle(testIcon);
            const font = computedStyle.fontFamily;
            
            // Verificar si Font Awesome está cargado
            const fontAwesomeLoaded = font.includes('Font Awesome') || font.includes('fontawesome') || font.includes('FontAwesome');
            
            {% if DEBUG %}
            if (fontAwesomeLoaded) {
                console.log('%c✓ Font Awesome cargado correctamente', 'color: green; font-weight: bold; font-size: 14px;');
                console.log('Fuente detectada:', font);
            } else {
                console.warn('%c⚠ Font Awesome NO está cargando correctamente', 'color: orange; font-weight: bold; font-size: 14px;');
                console.log('Fuente detectada:', font);
                console.log('Activando fallback de Font Awesome 6.4.0...');
                
                // Activar el enlace de fallback
                const fallbackLink = document.getElementById('font-awesome-fallback');
                if (fallbackLink) {
                    fallbackLink.disabled = false;
                }
                
                // Intentar cargar una tercera opción
                setTimeout(function() {
                    const testIcon2 = document.createElement('i');
                    testIcon2.className = 'fas fa-user';
                    testIcon2.style.position = 'absolute';
                    testIcon2.style.left = '-9999px';
                    document.body.appendChild(testIcon2);
                    
                    setTimeout(function() {
                        const font2 = window.getComputedStyle(testIcon2).fontFamily;
                        if (font2.includes('Font Awesome') || font2.includes('fontawesome')) {
                            console.log('%c✓ Fallback de Font Awesome 6.4.0 cargado correctamente', 'color: blue; font-weight: bold; font-size: 14px;');
                        } else {
                            console.warn('%c✗ Fallback también falló. Usando iconos emoji como último recurso.', 'color: red; font-weight: bold; font-size: 14px;');
                            // Los iconos emoji se activan automáticamente gracias al CSS font-awesome-fallback.css
                            document.body.classList.add('font-awesome-fallback-active');
                        }
                        document.body.removeChild(testIcon2);
                    }, 500);
                }, 500);
            }
            {% else %}
            // En producción, activar el fallback automáticamente si Font Awesome no carga
            if (!fontAwesomeLoaded) {
                const fallbackLink = document.getElementById('font-awesome-fallback');
                if (fallbackLink) {
                    fallbackLink.disabled = false;
                }
                document.body.classList.add('font-awesome-fallback-active');
            }
            {% endif %}
            
            document.body.removeChild(testIcon);
        }, 500);
    });
    </script>
</body>
</html>
